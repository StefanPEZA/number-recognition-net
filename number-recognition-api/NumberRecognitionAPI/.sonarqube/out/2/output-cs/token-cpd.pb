â/
oD:\number-recognition-net\number-recognition-api\NumberRecognitionAPI\Services\DatasetService\DatasetService.cs
	namespace 	
Services
 
. 
DatasetService !
{ 
public		 

class		 
DatasetService		 
:		  !
IDatasetService		" 1
{

 
private 
readonly 
IRepository $
<$ %
Dataset% ,
>, -
_repository. 9
;9 :
public 
DatasetService 
( 
IRepository )
<) *
Dataset* 1
>1 2

repository3 =
)= >
{ 	
_repository 
= 

repository $
;$ %
} 	
public 
async 
Task 
< 
IEnumerable %
<% &
Dataset& -
>- .
>. /
GetAllDatasetAsync0 B
(B C
stringC I
labelJ O
,O P
intQ T
limitU Z
=[ \
$num] _
)_ `
{ 	
return 
await 
_repository $
.$ %
GetAllAsync% 0
(0 1
limit1 6
,6 7
d8 9
=>: <
d= >
.> ?
Label? D
==E G
labelH M
)M N
;N O
} 	
public 
async 
Task 
< 
IEnumerable %
<% &
Dataset& -
>- .
>. /"
GetAllTestDatasetAsync0 F
(F G
stringG M
labelN S
,S T
intU X
limitY ^
=_ `
$numa c
)c d
{ 	
return 
await 
_repository $
.$ %
GetAllAsync% 0
(0 1
limit1 6
,6 7
d8 9
=>: <
(= >
bool> B
)B C
dC D
.D E
IsTestE K
&&L N
dO P
.P Q
LabelQ V
==W Y
labelZ _
)_ `
;` a
} 	
public 
async 
Task 
< 
IEnumerable %
<% &
Dataset& -
>- .
>. /#
GetAllTrainDatasetAsync0 G
(G H
stringH N
labelO T
,T U
intV Y
limitZ _
=` a
$numb d
)d e
{ 	
return 
await 
_repository $
.$ %
GetAllAsync% 0
(0 1
limit1 6
,6 7
d8 9
=>: <
!= >
(> ?
bool? C
)C D
dD E
.E F
IsTestF L
&&M O
dP Q
.Q R
LabelR W
==X Z
label[ `
)` a
;a b
} 	
public   
async   
Task   
<   
Dataset   !
>  ! "
GetDatasetAsync  # 2
(  2 3
Guid  3 7
id  8 :
)  : ;
{!! 	
return"" 
await"" 
_repository"" $
.""$ %
GetByIdAsync""% 1
(""1 2
id""2 4
)""4 5
;""5 6
}## 	
public%% 
async%% 
Task%% 
<%% 
bool%% 
>%% 
InsertIntoDataset%%  1
(%%1 2
Dataset%%2 9
dataset%%: A
)%%A B
{&& 	
try'' 
{(( 
await)) 
_repository)) !
.))! "
InsertAsync))" -
())- .
dataset)). 5
)))5 6
;))6 7
return** 
true** 
;** 
}++ 
catch,, 
(,, 
	Exception,, 
ex,, 
),,  
{-- 
Console.. 
... 
	WriteLine.. !
(..! "
ex.." $
)..$ %
;..% &
return// 
false// 
;// 
}00 
}11 	
public33 
async33 
Task33 
<33 
bool33 
>33 
UpdateDataset33  -
(33- .
Dataset33. 5
dataset336 =
)33= >
{44 	
try55 
{66 
await77 
_repository77 !
.77! "
UpdateAsync77" -
(77- .
dataset77. 5
)775 6
;776 7
return88 
true88 
;88 
}99 
catch:: 
(:: 
	Exception:: 
ex:: 
)::  
{;; 
Console<< 
.<< 
	WriteLine<< !
(<<! "
ex<<" $
)<<$ %
;<<% &
return== 
false== 
;== 
}>> 
}?? 	
publicAA 
asyncAA 
TaskAA 
<AA 
boolAA 
>AA "
DeleteFromDatasetAsyncAA  6
(AA6 7
GuidAA7 ;
idAA< >
)AA> ?
{BB 	
tryCC 
{DD 
DatasetEE 
datasetEE 
=EE  !
awaitEE" '
_repositoryEE( 3
.EE3 4
GetByIdAsyncEE4 @
(EE@ A
idEEA C
)EEC D
;EED E
awaitFF 
_repositoryFF !
.FF! "
DeleteAsyncFF" -
(FF- .
datasetFF. 5
)FF5 6
;FF6 7
returnGG 
trueGG 
;GG 
}HH 
catchII 
(II 
	ExceptionII 
exII 
)II  
{JJ 
ConsoleKK 
.KK 
	WriteLineKK !
(KK! "
exKK" $
)KK$ %
;KK% &
returnLL 
falseLL 
;LL 
}MM 
}NN 	
}OO 
}PP Ô
pD:\number-recognition-net\number-recognition-api\NumberRecognitionAPI\Services\DatasetService\IDatasetService.cs
	namespace 	
Services
 
. 
DatasetService !
{ 
public 

	interface 
IDatasetService $
{		 
Task

 
<

 
IEnumerable

 
<

 
Dataset

  
>

  !
>

! "
GetAllDatasetAsync

# 5
(

5 6
string

6 <
label

= B
,

B C
int

D G
limit

H M
=

N O
$num

P R
)

R S
;

S T
Task 
< 
IEnumerable 
< 
Dataset  
>  !
>! ""
GetAllTestDatasetAsync# 9
(9 :
string: @
labelA F
,F G
intH K
limitL Q
=R S
$numT V
)V W
;W X
Task 
< 
IEnumerable 
< 
Dataset  
>  !
>! "#
GetAllTrainDatasetAsync# :
(: ;
string; A
labelB G
,G H
intI L
limitM R
=S T
$numU W
)W X
;X Y
Task 
< 
Dataset 
> 
GetDatasetAsync %
(% &
Guid& *
id+ -
)- .
;. /
Task 
< 
bool 
> 
InsertIntoDataset $
($ %
Dataset% ,
dataset- 4
)4 5
;5 6
Task 
< 
bool 
> 
UpdateDataset  
(  !
Dataset! (
dataset) 0
)0 1
;1 2
Task 
< 
bool 
> "
DeleteFromDatasetAsync )
() *
Guid* .
id/ 1
)1 2
;2 3
} 
} É	
lD:\number-recognition-net\number-recognition-api\NumberRecognitionAPI\Services\ImageService\IImageService.cs
	namespace 	
Services
 
. 
ImageService 
{ 
public 

	interface 
IImageService "
{ 
Task 
< 
byte 
[ 
] 
> 
Resize 
( 
byte  
[  !
]! "
source# )
,) *
int* -
width. 3
,3 4
int5 8
height9 ?
)? @
;@ A
Task		 
<		 
byte		 
[		 
]		 
>		 
Crop		 
(		 
byte		 
[		 
]		  
source		! '
)		' (
;		( )
Task

 
<

 
List

 
<

 
byte

 
[

 
]

 
>

 
>

 
Split

  
(

  !
byte

! %
[

% &
]

& '
source

( .
)

. /
;

/ 0
} 
} …∑
mD:\number-recognition-net\number-recognition-api\NumberRecognitionAPI\Services\ImageService\ImageProcessor.cs
	namespace 	
Services
 
. 
ImageService 
{ 
class 	
ImageProcessor
 
{ 
private 
readonly 
Image 
< 
Rgba32 %
>% &
image' ,
;, -
private 
string 
ImageMatrix "
{# $
get% (
;( )
set* -
;- .
}/ 0
public 
ImageProcessor 
( 
byte "
[" #
]# $
source% +
)+ ,
{ 	
image 
= 
Image 
. 
Load 
< 
Rgba32 %
>% &
(& '
source' -
)- .
;. /
} 	
private 
Task 
< 
int 
[ 
, 
] 
> $
GetPixelMatrixFromBitmap 5
(5 6
)6 7
{ 	
int 
[ 
, 
] 
result 
= 
new 
int  #
[# $
image$ )
.) *
Height* 0
,0 1
image2 7
.7 8
Width8 =
]= >
;> ?
StringBuilder 
lines 
=  !
new" %
StringBuilder& 3
(3 4
)4 5
;5 6
for 
( 
int 
i 
= 
$num 
; 
i 
< 
image  %
.% &
Height& ,
;, -
i. /
++/ 1
)1 2
{   
lines!! 
.!! 
Append!! 
(!! 
$char!!  
)!!  !
;!!! "
for"" 
("" 
int"" 
j"" 
="" 
$num"" 
;"" 
j""  !
<""" #
image""$ )
."") *
Width""* /
;""/ 0
j""1 2
++""2 4
)""4 5
{## 
Rgba32%% 
pixel%%  
=%%! "
image%%# (
[%%( )
j%%) *
,%%* +
i%%, -
]%%- .
;%%. /
if&& 
(&& 
pixel&& 
.&& 
R&& 
<=&&  "
$num&&# %
||&&& (
pixel&&) .
.&&. /
G&&/ 0
<=&&1 3
$num&&4 6
||&&7 9
pixel&&: ?
.&&? @
B&&@ A
<=&&B D
$num&&E G
)&&G H
{'' 
result(( 
[(( 
i((  
,((  !
j((" #
]((# $
=((% &
pixel((' ,
.((, -
A((- .
;((. /
lines)) 
.)) 
Append)) $
())$ %
pixel))% *
.))* +
A))+ ,
.)), -
ToString))- 5
())5 6
)))6 7
+))8 9
$str)): =
)))= >
;))> ?
}** 
else++ 
{,, 
result-- 
[-- 
i--  
,--  !
j--" #
]--# $
=--% &
$num--' (
;--( )
lines.. 
... 
Append.. $
(..$ %
$str..% *
)..* +
;..+ ,
}// 
}11 
lines22 
.22 
Append22 
(22 
$str22 #
)22# $
;22$ %
}33 
ImageMatrix44 
=44 
lines44 
.44  
ToString44  (
(44( )
)44) *
;44* +
File55 
.55 
WriteAllLines55 
(55 
$str55 )
,55) *
ImageMatrix55+ 6
.556 7
Split557 <
(55< =
$str55= A
)55A B
)55B C
;55C D
return66 
Task66 
.66 

FromResult66 "
(66" #
result66# )
)66) *
;66* +
}77 	
private99 
Image99 
<99 
Rgba3299 
>99 
FillToAspectRatio99 /
(99/ 0
int990 3
width994 9
,999 :
int99; >
height99? E
)99E F
{:: 	
double;; 
ratioH;; 
=;; 
Math;;  
.;;  !
Max;;! $
(;;$ %
(;;% &
double;;& ,
);;, -
width;;- 2
/;;3 4
image;;5 :
.;;: ;
Width;;; @
,;;@ A
(;;B C
double;;C I
);;I J
image;;J O
.;;O P
Width;;P U
/;;V W
width;;X ]
);;] ^
;;;^ _
double<< 
ratioW<< 
=<< 
Math<<  
.<<  !
Max<<! $
(<<$ %
(<<% &
double<<& ,
)<<, -
height<<- 3
/<<4 5
image<<6 ;
.<<; <
Height<<< B
,<<B C
(<<D E
double<<E K
)<<K L
image<<L Q
.<<Q R
Height<<R X
/<<Y Z
height<<[ a
)<<a b
;<<b c
Size== 
newSize== 
=== 
new== 
Size== #
(==# $
(==$ %
int==% (
)==( )
(==) *
width==* /
*==0 1
ratioW==2 8
)==8 9
+==: ;
(==< =
image=== B
.==B C
Width==C H
/==I J
$num==K L
)==L M
,==M N
(==O P
int==P S
)==S T
(==T U
height==U [
*==\ ]
ratioH==^ d
)==d e
+==f g
(==h i
image==i n
.==n o
Height==o u
/==v w
$num==x y
)==y z
)==z {
;=={ |
Image>> 
<>> 
Rgba32>> 
>>> 
newImage>> "
=>># $
new>>% (
Image>>) .
<>>. /
Rgba32>>/ 5
>>>5 6
(>>6 7
newSize>>7 >
.>>> ?
Width>>? D
,>>D E
newSize>>F M
.>>M N
Height>>N T
)>>T U
;>>U V
newImage@@ 
.@@ 
Mutate@@ 
(@@ 
ic@@ 
=>@@ !
{AA 
icBB 
.BB 
FillBB 
(BB 
ColorBB 
.BB 
WhiteBB #
,BB# $
newBB% (

RectangleFBB) 3
(BB3 4
$numBB4 5
,BB5 6
$numBB7 8
,BB8 9
newSizeBB: A
.BBA B
WidthBBB G
,BBG H
newSizeBBI P
.BBP Q
HeightBBQ W
)BBW X
)BBX Y
;BBY Z
icCC 
.CC 
	DrawImageCC 
(CC 
imageCC "
,CC" #
newCC$ '
PointCC( -
(CC- .
(CC. /
newSizeCC/ 6
.CC6 7
WidthCC7 <
/CC= >
$numCC? @
)CC@ A
-CCB C
(CCD E
imageCCE J
.CCJ K
WidthCCK P
/CCQ R
$numCCS T
)CCT U
,CCU V
(CCW X
newSizeCCX _
.CC_ `
HeightCC` f
/CCg h
$numCCi j
)CCj k
-CCl m
(CCn o
imageCCo t
.CCt u
HeightCCu {
/CC| }
$numCC~ 
)	CC Ä
)
CCÄ Å
,
CCÅ Ç
$num
CCÉ Ñ
)
CCÑ Ö
;
CCÖ Ü
}DD 
)DD 
;DD 
returnKK 
newImageKK 
;KK 
}LL 	
publicNN 
asyncNN 
TaskNN 
<NN 
byteNN 
[NN 
]NN  
>NN  !
ResizeNN" (
(NN( )
intNN) ,
widthNN- 2
,NN2 3
intNN4 7
heightNN8 >
)NN> ?
{OO 	
ImagePP 
<PP 
Rgba32PP 
>PP 
newImagePP "
=PP# $
awaitPP% *
TaskPP+ /
.PP/ 0
RunPP0 3
(PP3 4
(PP4 5
)PP5 6
=>PP7 9
FillToAspectRatioPP: K
(PPK L
widthPPL Q
,PPQ R
heightPPS Y
)PPY Z
)PPZ [
;PP[ \
ImageQQ 
<QQ 
Rgba32QQ 
>QQ 
resultQQ  
=QQ! "
newQQ# &
ImageQQ' ,
<QQ, -
Rgba32QQ- 3
>QQ3 4
(QQ4 5
widthQQ5 :
,QQ: ;
heightQQ< B
)QQB C
;QQC D
ImageRR 
<RR 
Rgba32RR 
>RR 
	tempImageRR #
=RR$ %
newImageRR& .
;RR. /
	tempImageSS 
.SS 
MutateSS 
(SS 
icSS 
=>SS  "
{TT 
icUU 
.UU 
ResizeUU 
(UU 
widthUU 
,UU  
heightUU! '
)UU' (
;UU( )
}VV 
)VV 
;VV 
resultXX 
=XX 
	tempImageXX 
;XX 
var`` 
stream`` 
=`` 
new`` 
MemoryStream`` )
(``) *
)``* +
;``+ ,
resultaa 
.aa 
	SaveAsPngaa 
(aa 
streamaa #
)aa# $
;aa$ %
newImagecc 
.cc 
Disposecc 
(cc 
)cc 
;cc 
resultdd 
.dd 
Disposedd 
(dd 
)dd 
;dd 
returngg 
streamgg 
.gg 
ToArraygg !
(gg! "
)gg" #
;gg# $
}hh 	
publickk 
asynckk 
Taskkk 
<kk 
bytekk 
[kk 
]kk  
>kk  !
Cropkk" &
(kk& '
)kk' (
{ll 	
intmm 
[mm 
,mm 
]mm 
imageMatrixmm 
=mm  
awaitmm! &
Taskmm' +
.mm+ ,
Runmm, /
(mm/ 0$
GetPixelMatrixFromBitmapmm0 H
)mmH I
;mmI J
intoo 
minWoo 
=oo 
imageoo 
.oo 
Widthoo "
;oo" #
intpp 
maxWpp 
=pp 
$numpp 
;pp 
intrr 
minHrr 
=rr 
imagerr 
.rr 
Heightrr #
;rr# $
intss 
maxHss 
=ss 
$numss 
;ss 
foruu 
(uu 
intuu 
iuu 
=uu 
$numuu 
;uu 
iuu 
<uu 
imageuu  %
.uu% &
Heightuu& ,
;uu, -
iuu. /
++uu/ 1
)uu1 2
{vv 
forww 
(ww 
intww 
jww 
=ww 
$numww 
;ww 
jww  !
<ww" #
imageww$ )
.ww) *
Widthww* /
;ww/ 0
jww1 2
++ww2 4
)ww4 5
{xx 
ifyy 
(yy 
imageMatrixyy #
[yy# $
iyy$ %
,yy% &
jyy' (
]yy( )
==yy* ,
$numyy- 0
&&yy1 3
jyy4 5
>yy6 7
maxWyy8 <
)yy< =
maxWzz 
=zz 
jzz  
;zz  !
if{{ 
({{ 
imageMatrix{{ #
[{{# $
i{{$ %
,{{% &
j{{' (
]{{( )
=={{* ,
$num{{- 0
&&{{1 3
j{{4 5
<{{6 7
minW{{8 <
){{< =
minW|| 
=|| 
j||  
;||  !
if}} 
(}} 
imageMatrix}} #
[}}# $
i}}$ %
,}}% &
j}}' (
]}}( )
==}}* ,
$num}}- 0
&&}}1 3
i}}4 5
>}}6 7
maxH}}8 <
)}}< =
maxH~~ 
=~~ 
i~~  
;~~  !
if 
( 
imageMatrix #
[# $
i$ %
,% &
j' (
]( )
==* ,
$num- 0
&&1 3
i4 5
<6 7
minH8 <
)< =
minH
ÄÄ 
=
ÄÄ 
i
ÄÄ  
;
ÄÄ  !
}
ÅÅ 
}
ÇÇ 
int
ÑÑ 
widthBlackSpaces
ÑÑ  
=
ÑÑ! "
maxW
ÑÑ# '
-
ÑÑ( )
minW
ÑÑ* .
+
ÑÑ/ 0
$num
ÑÑ1 2
;
ÑÑ2 3
int
ÖÖ 
heightBlackSpaces
ÖÖ !
=
ÖÖ" #
maxH
ÖÖ$ (
-
ÖÖ) *
minH
ÖÖ+ /
+
ÖÖ0 1
$num
ÖÖ2 3
;
ÖÖ3 4
Image
ââ 
<
ââ 
Rgba32
ââ 
>
ââ 
result
ââ  
=
ââ! "
new
ââ# &
Image
ââ' ,
<
ââ, -
Rgba32
ââ- 3
>
ââ3 4
(
ââ4 5
widthBlackSpaces
ââ5 E
,
ââE F
heightBlackSpaces
ââG X
)
ââX Y
;
ââY Z
int
ãã 
[
ãã 
,
ãã 
]
ãã 
resultMatrix
ãã 
=
ãã  !
new
ãã" %
int
ãã& )
[
ãã) *
heightBlackSpaces
ãã* ;
,
ãã; <
widthBlackSpaces
ãã= M
]
ããM N
;
ããN O
for
çç 
(
çç 
int
çç 
i
çç 
=
çç 
$num
çç 
;
çç 
i
çç 
<
çç 
heightBlackSpaces
çç  1
;
çç1 2
i
çç3 4
++
çç4 6
)
çç6 7
{
éé 
for
èè 
(
èè 
int
èè 
j
èè 
=
èè 
$num
èè 
;
èè 
j
èè  !
<
èè" #
widthBlackSpaces
èè$ 4
;
èè4 5
j
èè6 7
++
èè7 9
)
èè9 :
{
êê 
resultMatrix
ëë  
[
ëë  !
i
ëë! "
,
ëë" #
j
ëë$ %
]
ëë% &
=
ëë' (
imageMatrix
ëë) 4
[
ëë4 5
minH
ëë5 9
+
ëë: ;
i
ëë< =
,
ëë= >
minW
ëë? C
+
ëëD E
j
ëëF G
]
ëëG H
;
ëëH I
if
íí 
(
íí 
resultMatrix
íí $
[
íí$ %
i
íí% &
,
íí& '
j
íí( )
]
íí) *
==
íí+ -
$num
íí. /
)
íí/ 0
{
ìì 
result
îî 
[
îî 
j
îî  
,
îî  !
i
îî! "
]
îî" #
=
îî$ %
Color
îî& +
.
îî+ ,
FromRgb
îî, 3
(
îî3 4
$num
îî4 7
,
îî7 8
$num
îî9 <
,
îî< =
$num
îî> A
)
îîA B
;
îîB C
}
ïï 
else
ññ 
{
óó 
result
òò 
[
òò 
j
òò  
,
òò  !
i
òò" #
]
òò# $
=
òò% &
Color
òò' ,
.
òò, -
FromRgba
òò- 5
(
òò5 6
$num
òò6 7
,
òò7 8
$num
òò9 :
,
òò: ;
$num
òò< =
,
òò= >
Convert
òò? F
.
òòF G
ToByte
òòG M
(
òòM N
resultMatrix
òòN Z
[
òòZ [
i
òò[ \
,
òò\ ]
j
òò^ _
]
òò_ `
)
òò` a
)
òòa b
;
òòb c
}
ôô 
}
öö 
}
õõ 
result
ùù 
.
ùù 
	SaveAsPng
ùù 
(
ùù 
$str
ùù K
)
ùùK L
;
ùùL M
var
üü 
stream
üü 
=
üü 
new
üü 
MemoryStream
üü )
(
üü) *
)
üü* +
;
üü+ ,
result
†† 
.
†† 
	SaveAsPng
†† 
(
†† 
stream
†† #
)
††# $
;
††$ %
result
¢¢ 
.
¢¢ 
Dispose
¢¢ 
(
¢¢ 
)
¢¢ 
;
¢¢ 
return
££ 
stream
££ 
.
££ 
ToArray
££ !
(
££! "
)
££" #
;
££# $
}
§§ 	
private
¶¶ 
Image
¶¶ 
<
¶¶ 
Rgba32
¶¶ 
>
¶¶ 
BitmapCreator
¶¶ +
(
¶¶+ ,
int
¶¶, /

splitIndex
¶¶0 :
,
¶¶: ;
int
¶¶< ?
	lastSplit
¶¶@ I
,
¶¶I J
int
¶¶K N
[
¶¶N O
,
¶¶O P
]
¶¶P Q
imageMatrix
¶¶R ]
)
¶¶] ^
{
ßß 	
Image
®® 
<
®® 
Rgba32
®® 
>
®® 
temp
®® 
=
®®  
new
®®! $
Image
®®% *
<
®®* +
Rgba32
®®+ 1
>
®®1 2
(
®®2 3

splitIndex
®®3 =
-
®®> ?
	lastSplit
®®@ I
,
®®I J
image
®®K P
.
®®P Q
Height
®®Q W
)
®®W X
;
®®X Y
for
©© 
(
©© 
int
©© 
j
©© 
=
©© 
$num
©© 
;
©© 
j
©© 
<
©© 
image
©©  %
.
©©% &
Height
©©& ,
;
©©, -
j
©©. /
++
©©/ 1
)
©©1 2
for
™™ 
(
™™ 
int
™™ 
i
™™ 
=
™™ 
	lastSplit
™™ &
;
™™& '
i
™™( )
<
™™* +

splitIndex
™™, 6
;
™™6 7
i
™™8 9
++
™™9 ;
)
™™; <
{
´´ 
if
¨¨ 
(
¨¨ 
imageMatrix
¨¨ #
[
¨¨# $
j
¨¨$ %
,
¨¨% &
i
¨¨' (
]
¨¨( )
==
¨¨* ,
$num
¨¨- .
)
¨¨. /
{
≠≠ 
temp
ÆÆ 
[
ÆÆ 
i
ÆÆ 
-
ÆÆ  
	lastSplit
ÆÆ! *
,
ÆÆ* +
j
ÆÆ, -
]
ÆÆ- .
=
ÆÆ/ 0
Color
ÆÆ1 6
.
ÆÆ6 7
FromRgb
ÆÆ7 >
(
ÆÆ> ?
$num
ÆÆ? B
,
ÆÆB C
$num
ÆÆD G
,
ÆÆG H
$num
ÆÆI L
)
ÆÆL M
;
ÆÆM N
}
ØØ 
else
∞∞ 
{
±± 
temp
≤≤ 
[
≤≤ 
i
≤≤ 
-
≤≤  
	lastSplit
≤≤! *
,
≤≤* +
j
≤≤, -
]
≤≤- .
=
≤≤/ 0
Color
≤≤1 6
.
≤≤6 7
FromRgba
≤≤7 ?
(
≤≤? @
$num
≤≤@ A
,
≤≤A B
$num
≤≤C D
,
≤≤D E
$num
≤≤F G
,
≤≤G H
Convert
≤≤I P
.
≤≤P Q
ToByte
≤≤Q W
(
≤≤W X
imageMatrix
≤≤X c
[
≤≤c d
j
≤≤d e
,
≤≤e f
i
≤≤g h
]
≤≤h i
)
≤≤i j
)
≤≤j k
;
≤≤k l
}
≥≥ 
}
¥¥ 
return
µµ 
temp
µµ 
;
µµ 
}
∂∂ 	
public
∏∏ 
async
∏∏ 
Task
∏∏ 
<
∏∏ 
List
∏∏ 
<
∏∏ 
byte
∏∏ #
[
∏∏# $
]
∏∏$ %
>
∏∏% &
>
∏∏& '
Split
∏∏( -
(
∏∏- .
)
∏∏. /
{
ππ 	
List
∫∫ 
<
∫∫ 
byte
∫∫ 
[
∫∫ 
]
∫∫ 
>
∫∫ 
result
∫∫ 
=
∫∫  !
new
∫∫" %
List
∫∫& *
<
∫∫* +
byte
∫∫+ /
[
∫∫/ 0
]
∫∫0 1
>
∫∫1 2
(
∫∫2 3
)
∫∫3 4
;
∫∫4 5
int
ªª 
[
ªª 
,
ªª 
]
ªª 
imageMatrix
ªª 
=
ªª  
await
ªª! &
Task
ªª' +
.
ªª+ ,
Run
ªª, /
(
ªª/ 0&
GetPixelMatrixFromBitmap
ªª0 H
)
ªªH I
;
ªªI J
int
ºº 
lastNotBank
ºº 
=
ºº 
-
ºº 
$num
ºº  
;
ºº  !
List
ΩΩ 
<
ΩΩ 
int
ΩΩ 
>
ΩΩ 
	splitList
ΩΩ 
=
ΩΩ  !
new
ΩΩ" %
List
ΩΩ& *
<
ΩΩ* +
int
ΩΩ+ .
>
ΩΩ. /
(
ΩΩ/ 0
)
ΩΩ0 1
;
ΩΩ1 2
for
øø 
(
øø 
int
øø 
j
øø 
=
øø 
$num
øø 
;
øø 
j
øø 
<
øø 
image
øø  %
.
øø% &
Width
øø& +
;
øø+ ,
j
øø- .
++
øø. 0
)
øø0 1
{
¿¿ 
bool
¡¡ 
isLineWhite
¡¡  
=
¡¡! "
true
¡¡# '
;
¡¡' (
for
¬¬ 
(
¬¬ 
int
¬¬ 
i
¬¬ 
=
¬¬ 
$num
¬¬ 
;
¬¬ 
i
¬¬  !
<
¬¬" #
image
¬¬$ )
.
¬¬) *
Height
¬¬* 0
;
¬¬0 1
i
¬¬2 3
++
¬¬3 5
)
¬¬5 6
if
√√ 
(
√√ 
imageMatrix
√√ #
[
√√# $
i
√√$ %
,
√√% &
j
√√' (
]
√√( )
==
√√* ,
$num
√√- 0
)
√√0 1
{
ƒƒ 
isLineWhite
≈≈ #
=
≈≈$ %
false
≈≈& +
;
≈≈+ ,
lastNotBank
∆∆ #
=
∆∆$ %
$num
∆∆& '
;
∆∆' (
}
«« 
if
»» 
(
»» 
isLineWhite
»» 
&&
»»  "
lastNotBank
»»# .
!=
»»/ 1
-
»»2 3
$num
»»3 4
)
»»4 5
{
…… 
	splitList
   
.
   
Add
   !
(
  ! "
j
  " #
)
  # $
;
  $ %
lastNotBank
ÀÀ 
=
ÀÀ  !
-
ÀÀ" #
$num
ÀÀ# $
;
ÀÀ$ %
}
ÃÃ 
}
ÕÕ 
int
œœ 
	lastSplit
œœ 
=
œœ 
$num
œœ 
;
œœ 
foreach
““ 
(
““ 
int
““ 

splitIndex
““ #
in
““$ &
	splitList
““' 0
)
““0 1
{
”” 
Image
‘‘ 
<
‘‘ 
Rgba32
‘‘ 
>
‘‘ 
temp
‘‘ "
=
‘‘# $
BitmapCreator
‘‘% 2
(
‘‘2 3

splitIndex
‘‘3 =
,
‘‘= >
	lastSplit
‘‘? H
,
‘‘H I
imageMatrix
‘‘J U
)
‘‘U V
;
‘‘V W
	lastSplit
’’ 
=
’’ 

splitIndex
’’ &
;
’’& '
var
◊◊ 
stream
◊◊ 
=
◊◊ 
new
◊◊  
MemoryStream
◊◊! -
(
◊◊- .
)
◊◊. /
;
◊◊/ 0
temp
ÿÿ 
.
ÿÿ 
	SaveAsPng
ÿÿ 
(
ÿÿ 
stream
ÿÿ %
)
ÿÿ% &
;
ÿÿ& '
temp
ŸŸ 
.
ŸŸ 
Dispose
ŸŸ 
(
ŸŸ 
)
ŸŸ 
;
ŸŸ 
result
⁄⁄ 
.
⁄⁄ 
Add
⁄⁄ 
(
⁄⁄ 
stream
⁄⁄ !
.
⁄⁄! "
ToArray
⁄⁄" )
(
⁄⁄) *
)
⁄⁄* +
)
⁄⁄+ ,
;
⁄⁄, -
}
‹‹ 
return
ﬁﬁ 
result
ﬁﬁ 
;
ﬁﬁ 
}
ﬂﬂ 	
public
‚‚ 
override
‚‚ 
string
‚‚ 
ToString
‚‚ '
(
‚‚' (
)
‚‚( )
{
„„ 	
return
‰‰ 
ImageMatrix
‰‰ 
;
‰‰ 
}
ÂÂ 	
}
ÊÊ 
}ÁÁ ˛
kD:\number-recognition-net\number-recognition-api\NumberRecognitionAPI\Services\ImageService\ImageService.cs
	namespace 	
Services
 
. 
ImageService 
{ 
public 

class 
ImageService 
: 
IImageService  -
{ 
public		 
async		 
Task		 
<		 
byte		 
[		 
]		  
>		  !
Resize		" (
(		( )
byte		) -
[		- .
]		. /
source		0 6
,		6 7
int		7 :
width		; @
,		@ A
int		B E
height		F L
)		L M
{

 	
return 
await 
new 
ImageProcessor +
(+ ,
source, 2
)2 3
.3 4
Resize4 :
(: ;
width; @
,@ A
heightA G
)G H
;H I
} 	
public 
async 
Task 
< 
byte 
[ 
]  
>  !
Crop" &
(& '
byte' +
[+ ,
], -
source. 4
)4 5
{ 	
return 
await 
new 
ImageProcessor +
(+ ,
source, 2
)2 3
.3 4
Crop4 8
(8 9
)9 :
;: ;
} 	
public 
async 
Task 
< 
List 
< 
byte #
[# $
]$ %
>% &
>& '
Split( -
(- .
byte. 2
[2 3
]3 4
source5 ;
); <
{ 	
return 
await 
new 
ImageProcessor +
(+ ,
source, 2
)2 3
.3 4
Split4 9
(9 :
): ;
;; <
} 	
} 
} 